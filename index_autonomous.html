<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sniper Elite - Autonomous AI</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .settings-section {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #ff4444;
            min-width: 250px;
            z-index: 1001;
            font-family: Arial, sans-serif;
        }

        .settings-title {
            color: #ff4444;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .setting-item {
            margin-bottom: 15px;
        }

        .setting-label {
            color: #ffaa44;
            font-size: 14px;
            margin-bottom: 8px;
            display: block;
        }

        .sensitivity-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sensitivity-slider {
            flex: 1;
            height: 6px;
            background: #333;
            border-radius: 3px;
            outline: none;
            cursor: pointer;
        }

        .sensitivity-slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            background: #ff4444;
            border-radius: 50%;
            cursor: pointer;
        }

        .sensitivity-value {
            color: #ffaa44;
            font-size: 14px;
            min-width: 35px;
            text-align: center;
            font-weight: bold;
        }

        .sensitivity-labels {
            display: flex;
            justify-content: space-between;
            color: #aaa;
            font-size: 11px;
            margin-top: 3px;
        }

        /* Menu Screen Styles */
        #menuScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            font-family: Arial, sans-serif;
        }

        #menuScreen.hidden {
            display: none !important;
        }

        .menu-title {
            font-size: 4rem;
            font-weight: bold;
            color: #e20000;
            text-shadow: 0 0 20px #801f1f, 0 0 40px #ff2626;
            margin-bottom: 1rem;
            text-align: center;
            animation: titlePulse 2s infinite;
            letter-spacing: 4px;
        }

        .menu-subtitle {
            font-size: 1.5rem;
            color: #ffaa44;
            margin-bottom: 3rem;
            text-align: center;
            text-shadow: 0 0 10px #ff8800;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .menu-button {
            padding: 15px 40px;
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ff4444, #ff0000);
            color: white;
            border: 3px solid #ffaa44;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.5);
            min-width: 250px;
        }

        .menu-button:hover {
            background: linear-gradient(45deg, #ff6666, #ff2222);
            box-shadow: 0 0 30px rgba(255, 68, 68, 0.8);
            transform: scale(1.05);
        }

        .menu-settings {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ff4444;
            min-width: 300px;
        }

        .menu-settings .settings-title {
            color: #ff4444;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        @keyframes titlePulse {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.02); }
        }
    </style>
</head>
<body>
    <!-- Menu Screen -->
    <div id="menuScreen" style="display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; background: rgba(0,0,0,0.9);">
        <h1 class="menu-title">SNIPER ELITE</h1>
        
        <div class="menu-buttons">
            <button class="menu-button" onclick="startGame()">START MISSION</button>
        </div>

        <div class="menu-settings">
            <div class="settings-title">⚙️ SETTINGS</div>
            <div class="setting-item">
                <label class="setting-label">Mouse Sensitivity</label>
                <div class="sensitivity-container">
                    <input type="range" id="menuSensitivitySlider" class="sensitivity-slider" min="0.2" max="2.0" step="0.1" value="0.8">
                    <span id="menuSensitivityValue" class="sensitivity-value">0.8</span>
                </div>
                <div class="sensitivity-labels">
                    <span>Low</span>
                    <span>High</span>
                </div>
            </div>
        </div>
    </div>
    <div id="gameContainer">
        <div id="hud">
            <div id="score">Score: <span id="scoreValue">0</span></div>
            <div id="ammo">Ammo: <span id="ammoValue">15</span></div>
            <div id="magazines">Mags: <span id="magazinesValue">3</span></div>
            <div id="health">
                <div class="health-label">HEALTH</div>
                <div class="health-bar-container">
                    <div class="health-bar" id="healthBar"></div>
                    <div class="health-text"><span id="healthValue">100</span></div>
                </div>
            </div>
            <div id="kills">Kills: <span id="killsValue">0</span></div>
            <div id="timer">Time: <span id="timeValue">60</span>s</div>
        </div>
        <div id="crosshair"></div>
        <div id="hipCrosshair"></div>
        <div id="scopeAmmo">AMMO: <span id="scopeAmmoValue">15</span></div>
        <div id="gameOver" class="hidden" style="display: none;">
            <h2>Mission Complete!</h2>
            <p>Final Score: <span id="finalScore">0</span></p>
            <p>Targets Eliminated: <span id="targetsKilled">0</span></p>
            <button id="restartBtn">New Mission</button>
        </div>
        <div id="loading" style="display: none;">Loading 3D Environment...</div>
        
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="ai_autonomous_fixed.js"></script>
    <script src="tower3d.js"></script>
    <script>
        let gameStarted = false;

        // Initialize menu sensitivity controls
        function initMenuSensitivityControls() {
            const sensitivitySlider = document.getElementById('menuSensitivitySlider');
            const sensitivityValue = document.getElementById('menuSensitivityValue');

            // Load saved sensitivity from localStorage (default to 0.8 for lower sensitivity)
            const savedSensitivity = localStorage.getItem('mouseSensitivity');
            if (savedSensitivity) {
                sensitivitySlider.value = savedSensitivity;
                sensitivityValue.textContent = savedSensitivity;
            } else {
                // Set default to lower sensitivity
                localStorage.setItem('mouseSensitivity', '0.8');
            }

            // Handle slider changes
            sensitivitySlider.addEventListener('input', function() {
                const value = parseFloat(this.value).toFixed(1);
                sensitivityValue.textContent = value;
                localStorage.setItem('mouseSensitivity', value);
                console.log('Mouse sensitivity set to:', value);
            });

            // Handle mouse wheel for fine adjustment
            sensitivitySlider.addEventListener('wheel', function(e) {
                e.preventDefault();
                const currentValue = parseFloat(this.value);
                const step = 0.1;
                let newValue;
                
                if (e.deltaY < 0) {
                    newValue = Math.min(2.0, currentValue + step);
                } else {
                    newValue = Math.max(0.2, currentValue - step);
                }
                
                this.value = newValue.toFixed(1);
                sensitivityValue.textContent = newValue.toFixed(1);
                localStorage.setItem('mouseSensitivity', newValue.toFixed(1));
            });
        }

        // Start the game
        function startGame() {
            if (gameStarted) return;
            
            gameStarted = true;
            window.gameStarted = true; // Set global flag
            console.log('Starting game with sensitivity:', localStorage.getItem('mouseSensitivity'));
            
            // Hide menu screen
            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'block';
            
            // Initialize the main game
            if (typeof init === 'function') {
                init();
            } else {
                // If init function isn't loaded yet, wait for it
                setTimeout(() => {
                    if (typeof init === 'function') {
                        init();
                    }
                }, 500);
            }
        }
        
        // Ensure menu is visible on load and prevent auto-start
        window.gameStarted = false;
        
        // Override any auto-initialization
        window.addEventListener('DOMContentLoaded', function() {
            // Force menu to be visible and block game
            const menuScreen = document.getElementById('menuScreen');
            menuScreen.style.display = 'flex';
            menuScreen.classList.remove('hidden');
            
            // Force game elements to be hidden
            document.getElementById('gameContainer').style.display = 'none';
            
            console.log('Menu screen displayed - game blocked until start clicked');
        });

        // Initialize when page loads
        window.addEventListener('load', initMenuSensitivityControls);
    </script>
</body>
</html>
